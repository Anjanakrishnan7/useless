<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bark Verification CAPTCHA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            margin: 0;
        }
        
        .captcha-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        .dog-image-container {
            width: 170px; /* 100px + 3px border on each side */
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 50%;
            border: 3px solid #000000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .dog-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .visualizer {
            width: 200px;
            height: 100px;
            margin: 20px auto;
            background: #f0f0f0;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .sound-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: #4CAF50;
            border-radius: 2px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .status {
            margin-top: 20px;
            font-weight: bold;
            min-height: 24px;
        }
        
        .success {
            color: #4CAF50;
        }
        
        .error {
            color: #f44336;
        }
        
        .timer {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="captcha-container">
        <!-- Image container with centered image -->
        <div class="dog-image-container">
            <img src="C:\Users\ADMIN\Desktop\useless\Screenshot 2025-08-02 020510.png" alt="Dog" class="dog-image">
        </div>
        <h2>Bark Verification</h2>
        <p>Bark like a dog to prove you're not a human!</p>
        
        <div class="visualizer" id="visualizer"></div>
        
        <button id="recordBtn">Start Barking</button>
        <div class="timer" id="timer"></div>
        <div class="status" id="status"></div>
    </div>

    <audio id="wobblyWigglySong" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const recordBtn = document.getElementById('recordBtn');
            const statusEl = document.getElementById('status');
            const timerEl = document.getElementById('timer');
            const visualizer = document.getElementById('visualizer');
            
            const wobblyWigglySong = document.getElementById('wobblyWigglySong');

            let audioContext;
            let analyser;
            let microphone;
            let isRecording = false;
            let barkDetected = false;
            let animationId;
            let countdownTimer;
            let timeLeft = 10;
            
            // Create sound bars for visualization
            for (let i = 0; i < 50; i++) {
                const bar = document.createElement('div');
                bar.className = 'sound-bar';
                bar.style.left = `${i * 5}px`;
                bar.style.height = '0px';
                visualizer.appendChild(bar);
            }
            const soundBars = document.querySelectorAll('.sound-bar');
            
            // Initialize audio context on user interaction
            recordBtn.addEventListener('click', async function() {
                if (!isRecording) {
                    try {
                        // Request microphone permission
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        
                        // Set up audio context
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        analyser = audioContext.createAnalyser();
                        analyser.fftSize = 256;
                        
                        microphone = audioContext.createMediaStreamSource(stream);
                        microphone.connect(analyser);
                        
                        isRecording = true;
                        barkDetected = false;
                        timeLeft = 10;
                        recordBtn.textContent = 'Stop Recording';
                        statusEl.textContent = 'Bark now!';
                        statusEl.className = 'status';
                        
                        // Start countdown timer
                        startCountdown();
                        
                        // Start visualization
                        visualize();
                        
                        // Start analyzing for barks
                        analyzeBark();
                    } catch (error) {
                        statusEl.textContent = `Pawthentication Error: ${error.message}`;
                        statusEl.className = 'Pawthentication error';
                    }
                } else {
                    // Stop recording
                    stopRecording();
                    
                    if (!barkDetected) {
                        statusEl.textContent = 'No bark detected. Pawthenticate again!';
                        statusEl.className = 'Pawthentication error';
                    }
                }
            });
            
            function startCountdown() {
                clearInterval(countdownTimer);
                timerEl.textContent = `Time left: ${timeLeft} seconds`;
                
                countdownTimer = setInterval(() => {
                    timeLeft--;
                    timerEl.textContent = `Time left: ${timeLeft} seconds`;
                    
                    if (timeLeft <= 0) {
                        clearInterval(countdownTimer);
                        if (!barkDetected) {
                            statusEl.textContent = 'You must be a human! Pawthenticate again.';
                            statusEl.className = 'Pawthentication error';
                            stopRecording();
                        }
                    }
                }, 1000);
            }
            
            function stopRecording() {
                isRecording = false;
                recordBtn.textContent = 'Start Barking';
                clearInterval(countdownTimer);
                timerEl.textContent = '';
                cancelAnimationFrame(animationId);
                
                if (audioContext) {
                    if (microphone) microphone.disconnect();
                    if (audioContext.state !== 'closed') {
                        audioContext.close();
                    }
                }
            }
            
            function visualize() {
                animationId = requestAnimationFrame(visualize);
                
                if (!analyser) return;
                
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);
                
                // Update visualization bars
                for (let i = 0; i < soundBars.length; i++) {
                    const index = Math.floor(i * bufferLength / soundBars.length);
                    const value = dataArray[index] / 2;
                    soundBars[i].style.height = `${value}px`;
                    soundBars[i].style.backgroundColor = value > 40 ? '#f44336' : '#4CAF50';
                }
            }
            
            function analyzeBark() {
                if (!isRecording || barkDetected) return; // Stop analyzing if bark is already found
                
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);
                
                // Calculate average volume
                let sum = 0;
                for (let i = 0; i < bufferLength; i++) {
                    sum += dataArray[i];
                }
                const average = sum / bufferLength;
                
                // Check for bark characteristics (simplified)
                if (average > 80) { // Loud sound
                    setTimeout(() => {
                        analyser.getByteFrequencyData(dataArray);
                        let newSum = 0;
                        for (let i = 0; i < bufferLength; i++) {
                            newSum += dataArray[i];
                        }
                        const newAverage = newSum / bufferLength;
                        
                        if (newAverage < 50) { // Quick drop after loud sound
                            barkDetected = true;
                            statusEl.textContent = 'Bark detected! Pawthentication successfull...';
                            statusEl.className = 'Pawthentication successfull';
                            recordBtn.disabled = true;
                            clearInterval(countdownTimer);
                            
                            wobblyWigglySong.play();

                            setTimeout(() => {
                                window.location.href = "public.html";
                            }, 2500);
                        }
                    }, 200);
                }
                
                // Continue analyzing if bark not found yet
                if (!barkDetected) {
                    setTimeout(analyzeBark, 100);
                }
            }
        });
    </script>
</body>
</html>